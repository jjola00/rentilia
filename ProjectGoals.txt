ProjectGoals.txt

Context Snapshot (as of this convo)
- App: Rentilia (Next.js 15, Supabase, Stripe).
- Key flows: listings -> bookings -> checkout -> return.
- New features already added: public profiles, reviews (double-blind visibility), contact form, pre-booking messaging, pickup/return photos, light/dark mode.

New Requests (from cofounder)
1) Listing condition field (brand new, excellent, good, fair, etc).
2) Price band / item value bracket (0-250, 250-500, etc) for insurance.
3) Category-specific value caps (no 10k camera).
4) Minimum 4 photos per listing.
5) 30s video required to show item is working.
6) Pre-rental agreement acknowledgment before payment.
7) FAQ page.
8) Email/phone/ID verification via third-party (no storage).
9) Search results show “most suitable rentals” section at top.

Implementation Notes + Likely Files

1) Listing Condition
- DB: add items.condition (enum or text with check constraint).
  Suggested values: 'brand_new', 'excellent', 'good', 'fair', 'poor'.
- Frontend:
  - Listing form: src/app/listings/new/page.tsx (new step or add to basic info).
  - Item detail: src/app/listings/[id]/page.tsx (display condition).
  - Item card optional badge.
- Validation: src/lib/validations/item.ts (add required condition).

2) Price Band / Item Value Bracket
- DB: add items.estimated_value + items.value_band.
  Value band could be derived server-side, but add explicit column for reporting.
  Example bands: 0-250, 250-500, 500-1000, 1000-2500, 2500-5000, 5000+.
- Frontend:
  - Listing form: add "Estimated value" (or "Replacement value" reuse) and a read-only or computed band.
  - Item detail: show value band (insurance context).
  - Browse filters: optional filter by band in src/app/browse/page.tsx.

3) Category-Specific Value Caps
- DB: add constraint or validation logic based on category.
- Frontend: enforce in form (zod refine) before submit.
- Optional: server-side enforcement in Supabase DB constraint or trigger.
- Needs: category caps table or config (src/lib/constants/categories.ts or new config file).

4) Minimum 4 Photos
- Frontend: enforce in PhotoUpload flow.
  - src/components/items/PhotoUpload.tsx
  - src/app/listings/new/page.tsx (block step progress unless >= 4)
- DB: optional check constraint on items.photo_urls length.

5) Required 30s Video
- Storage: new bucket (e.g., item-videos) or reuse existing with folder.
- DB: add items.video_url + items.video_duration.
- Frontend: add video upload in listing flow (Step 4 or new step).
  - Validate duration <= 30s (client-side).
  - Require video before listing is created.
- Note: duration validation can be done by loading video metadata in browser.

6) Pre-Rental Agreement Before Payment
- UI: add checkbox + link to agreement modal or page.
  - Booking flow: src/app/checkout/[bookingId]/page.tsx
  - or earlier in src/app/bookings/new/page.tsx before "Proceed to Payment".
- Backend: optional store acceptance timestamp in bookings table (bookings.agreement_accepted_at).
- Needs: agreement content location (likely in a new page or modal).

7) FAQ Page
- New page: src/app/faq/page.tsx.
- Link in footer: src/components/layout/footer.tsx.
- Content placeholder ok; we can stub questions and mark TODO.

8) Email/Phone/ID Verification (3rd Party)
- Decide provider (Stripe Identity, Persona, Veriff, etc).
- No storage of documents (only store verification status in profiles).
- DB: add profiles verification flags (email_verified, phone_verified, id_verified) if needed.
- UI: profile page shows verification status + CTA to verify.

9) “Most Suitable Rentals” Section on Search
- Browse page: src/app/browse/page.tsx.
  - Add a "Top Picks" section above results.
  - Ranking heuristic (e.g., newest + price in range + same city + high rating).
- Needs: definition of “most suitable” (rules or weights).

Potential New Migrations
- items: condition, estimated_value, value_band, video_url, video_duration.
- items constraints: category caps, min photos, valid condition.
- bookings: agreement_accepted_at (optional).
- profiles: verification flags (optional).

Open Questions (need answers)
1) Condition values: exact set + labels to show?
2) Value bands: exact ranges and label format?
3) Category caps: list of caps per category?
4) Video: where to store? (bucket name) and should we accept multiple videos?
5) Agreement content: final text? link to page? required on checkout or booking?
6) Verification provider preference + which checks are required to book/list?
7) “Most suitable” ranking rules (weights/priorities)?

Testing Checklist (for new tasks)
- Listing creation: fails if <4 photos or video missing; condition & value required.
- Listing validation: category cap enforced; band computed correctly.
- Item detail: condition/value/video display correct.
- Browse page: "Top Picks" shows and respects filters.
- Checkout: cannot proceed without agreement checkbox; acceptance stored if added.
- FAQ page loads and link works in footer.
- Verification UI shows states and CTA (if added).

Notes
- Supabase Edge Functions don’t read .env.local; set secrets in Supabase Dashboard.
- Storage buckets will need RLS policies if private; public buckets are simpler but expose URLs.
